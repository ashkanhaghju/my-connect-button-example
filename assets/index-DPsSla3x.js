const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BUbiDIUQ.js","assets/index-Ca74PG3G.css","assets/hashMessage-CXkFUHbu.js","assets/checkContractWalletSignature-BWwcMy3q.js","assets/isValidSignature-1gwbc4nF.js","assets/checkContractWalletSignedTypedData-Cbby885V.js","assets/send-eip712-transaction-DZ6NjpDd.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-DX_SPP17.js","assets/sha256-0_ecNwaH.js"])))=>i.map(i=>d[i]);
import{B as _t,o as rt,q as Lt,r as Et,v as U,A as Ct,x as Q,y as it,z as b,D as ot,E as k,F as X,G as Ut,H as ct,J as dt,K as ut,L as It,P as Vt,M as N,N as St,O as Ft,Q as Nt,R as L,S as O,T as Rt,U as E,V as j,i as Mt,W as P,X as z,a as pt,s as R,Y as w,Z as $t,$ as Ht,a0 as lt,a1 as W,a2 as _,a3 as mt,a4 as Bt,a5 as q,a6 as M,a7 as kt,a8 as jt,a9 as yt,aa as x,ab as zt,ac as Wt,ad as qt,ae as Zt,d as Kt,_ as v,p as ft,af as Yt,ag as Jt,f as Qt}from"./index-BUbiDIUQ.js";import{populateEip712Transaction as Xt,signEip712Transaction as te}from"./send-eip712-transaction-DZ6NjpDd.js";import{concatHex as ee}from"./concat-hex-DX_SPP17.js";import{m as ne}from"./sha256-0_ecNwaH.js";class ae extends _t{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const S=rt;function se(t){const{abi:e,args:n=[],name:a}=t,r=Lt(a,{strict:!1}),s=e.filter(i=>r?i.type==="function"?Et(i)===a:i.type==="event"?S(i)===a:!1:"name"in i&&i.name===a);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const i of s){if(!("inputs"in i))continue;if(!n||n.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==n.length)continue;if(n.every((d,u)=>{const p="inputs"in i&&i.inputs[u];return p?$(d,p):!1})){if(o&&"inputs"in o&&o.inputs){const d=ht(i.inputs,o.inputs,n);if(d)throw new Ct({abiItem:i,type:d[0]},{abiItem:o,type:d[1]})}o=i}}return o||s[0]}function $(t,e){const n=typeof t,a=e.type;switch(a){case"address":return U(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return a==="tuple"&&"components"in e?Object.values(e.components).every((r,s)=>$(Object.values(t)[s],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)?Array.isArray(t)&&t.every(r=>$(r,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function ht(t,e,n){for(const a in t){const r=t[a],s=e[a];if(r.type==="tuple"&&s.type==="tuple"&&"components"in r&&"components"in s)return ht(r.components,s.components,n[a]);const o=[r.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?U(n[a],{strict:!1}):o.includes("address")&&o.includes("bytes")?U(n[a],{strict:!1}):!1)return o}}const tt="/docs/contract/encodeEventTopics";function re(t){var c;const{abi:e,eventName:n,args:a}=t;let r=e[0];if(n){const d=se({abi:e,name:n});if(!d)throw new Q(n,{docsPath:tt});r=d}if(r.type!=="event")throw new Q(void 0,{docsPath:tt});const s=it(r),o=S(s);let i=[];if(a&&"inputs"in r){const d=(c=r.inputs)==null?void 0:c.filter(p=>"indexed"in p&&p.indexed),u=Array.isArray(a)?a:Object.values(a).length>0?(d==null?void 0:d.map(p=>a[p.name]))??[]:[];u.length>0&&(i=(d==null?void 0:d.map((p,f)=>Array.isArray(u[f])?u[f].map((A,h)=>et({param:p,value:u[f][h]})):u[f]?et({param:p,value:u[f]}):null))??[])}return[o,...i]}function et({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return b(ot(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new ae(t.type);return k([t],[e])}function ie(t,e){if(!U(t,{strict:!1}))throw new X({address:t});if(!U(e,{strict:!1}))throw new X({address:e});return t.toLowerCase()===e.toLowerCase()}const nt="/docs/contract/decodeEventLog";function oe(t){const{abi:e,data:n,strict:a,topics:r}=t,s=a??!0,[o,...i]=r;if(!o)throw new Ut({docsPath:nt});const c=e.length===1?e[0]:e.find(m=>m.type==="event"&&o===S(it(m)));if(!(c&&"name"in c)||c.type!=="event")throw new ct(o,{docsPath:nt});const{name:d,inputs:u}=c,p=u==null?void 0:u.some(m=>!("name"in m&&m.name));let f=p?[]:{};const A=u.filter(m=>"indexed"in m&&m.indexed);for(let m=0;m<A.length;m++){const G=A[m],g=i[m];if(!g)throw new dt({abiItem:c,param:G});f[p?m:G.name||m]=ce({param:G,value:g})}const h=u.filter(m=>!("indexed"in m&&m.indexed));if(h.length>0){if(n&&n!=="0x")try{const m=ut(h,n);if(m)if(p)f=[...f,...m];else for(let G=0;G<h.length;G++)f[h[G].name]=m[G]}catch(m){if(s)throw m instanceof It||m instanceof Vt?new N({abiItem:c,data:n,params:h,size:St(n)}):m}else if(s)throw new N({abiItem:c,data:"0x",params:h,size:0})}return{eventName:d,args:Object.values(f).length>0?f:void 0}}function ce({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(ut([t],e)||[])[0]}function de(t){const{abi:e,args:n,logs:a,strict:r=!0}=t,s=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return a.map(o=>{var i;try{const c=e.find(u=>u.type==="event"&&o.topics[0]===S(u));if(!c)return null;const d=oe({...o,abi:[c],strict:r});return s&&!s.includes(d.eventName)||!ue({args:d.args,inputs:c.inputs,matchArgs:n})?null:{...d,...o}}catch(c){let d,u;if(c instanceof ct)return null;if(c instanceof N||c instanceof dt){if(r)return null;d=c.abiItem.name,u=(i=c.abiItem.inputs)==null?void 0:i.some(p=>!("name"in p&&p.name))}return{...o,args:u?[]:{},eventName:d}}}).filter(Boolean)}function ue(t){const{args:e,inputs:n,matchArgs:a}=t;if(!a)return!0;if(!e)return!1;function r(s,o,i){try{return s.type==="address"?ie(o,i):s.type==="string"||s.type==="bytes"?b(ot(o))===i:o===i}catch{return!1}}return Array.isArray(e)&&Array.isArray(a)?a.every((s,o)=>{if(s==null)return!0;const i=n[o];return i?(Array.isArray(s)?s:[s]).some(d=>r(i,d,e[o])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof a=="object"&&!Array.isArray(a)?Object.entries(a).every(([s,o])=>{if(o==null)return!0;const i=n.find(d=>d.name===s);return i?(Array.isArray(o)?o:[o]).some(d=>r(i,d,e[s])):!1}):!1}function pe(t){const{domain:e={},message:n,primaryType:a}=t,r={EIP712Domain:Ft({domain:e}),...t.types};Nt({domain:e,message:n,primaryType:a,types:r});const s=["0x1901"];return e&&s.push(le({domain:e,types:r})),a!=="EIP712Domain"&&s.push(gt({data:n,primaryType:a,types:r})),b(L(s))}function le({domain:t,types:e}){return gt({data:t,primaryType:"EIP712Domain",types:e})}function gt({data:t,primaryType:e,types:n}){const a=At({data:t,primaryType:e,types:n});return b(a)}function At({data:t,primaryType:e,types:n}){const a=[{type:"bytes32"}],r=[me({primaryType:e,types:n})];for(const s of n[e]){const[o,i]=wt({types:n,name:s.name,type:s.type,value:t[s.name]});a.push(o),r.push(i)}return k(a,r)}function me({primaryType:t,types:e}){const n=O(ye({primaryType:t,types:e}));return b(n)}function ye({primaryType:t,types:e}){let n="";const a=Gt({primaryType:t,types:e});a.delete(t);const r=[t,...Array.from(a).sort()];for(const s of r)n+=`${s}(${e[s].map(({name:o,type:i})=>`${i} ${o}`).join(",")})`;return n}function Gt({primaryType:t,types:e},n=new Set){const a=t.match(/^\w*/u),r=a==null?void 0:a[0];if(n.has(r)||e[r]===void 0)return n;n.add(r);for(const s of e[r])Gt({primaryType:s.type,types:e},n);return n}function wt({types:t,name:e,type:n,value:a}){if(t[n]!==void 0)return[{type:"bytes32"},b(At({data:a,primaryType:n,types:t}))];if(n==="bytes")return a=`0x${(a.length%2?"0":"")+a.slice(2)}`,[{type:"bytes32"},b(a)];if(n==="string")return[{type:"bytes32"},b(O(a))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),s=a.map(o=>wt({name:e,type:r,types:t,value:o}));return[{type:"bytes32"},b(k(s.map(([o])=>o),s.map(([,o])=>o)))]}return[{type:n},a]}function fe(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function vt(t){const{signature:e}=t;let n;return fe(e)?n=e:n=Rt(e),{abiEvent:n,hash:rt(n),topics:re({abi:[n],args:t.filters})}}function he(t){const{logs:e,events:n,strict:a}=t;return de({logs:e,abi:n.map(r=>r.abiEvent),strict:a})}const ge="0xdd62ed3e",Ae=[{type:"address",name:"owner"},{type:"address",name:"spender"}],Ge=[{type:"uint256"}];async function we(t){return E({contract:t.contract,method:[ge,Ae,Ge],params:[t.owner,t.spender]})}function ve(t={}){return vt({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function be(t={}){return vt({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Oe(t){const{receipt:e}=t,n={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:n,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const Te=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|s};function Z(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,n==null||j(n)?n:Mt(n)]))}async function De(t){return C({...t,operation:"eth_sendUserOperation",params:[Z(t.userOp),t.options.entrypointAddress??P]})}async function I(t){const e=await C({...t,operation:"eth_estimateUserOperationGas",params:[Z(t.userOp),t.options.entrypointAddress??P]});return{preVerificationGas:w(e.preVerificationGas),verificationGas:e.verificationGas!==void 0?w(e.verificationGas):void 0,verificationGasLimit:w(e.verificationGasLimit),callGasLimit:w(e.callGasLimit)+$t,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?w(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?w(e.paymasterPostOpGasLimit):void 0}}async function Pe(t){const e=await C({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:w(e.maxPriorityFeePerGas),maxFeePerGas:w(e.maxFeePerGas)}}async function xe(t){var n,a;const e=await _e(t);if(e){if(e.success===!1){const s=(a=(n=he({events:[ve(),be()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:a.revertReason;if(!s)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=Ht({data:s});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function _e(t){const e=await C({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return Oe(e)}async function Le(t){const e=await C({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function Ee(t){return{transactionHash:(await C({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function C(t){const{options:e,operation:n,params:a}=t,r=e.bundlerUrl??z(e.chain),o=await pt(e.client)(r,{method:"POST",headers:{"Content-Type":"application/json"},body:R({jsonrpc:"2.0",id:1,method:n,params:a})}),i=await o.json();if(!o.ok||i.error){let c=i.error||o.statusText;typeof c=="object"&&(c=R(c));const d=i.code||"UNKNOWN";throw new Error(`${n} error: ${c}
Status: ${o.status}
Code: ${d}`)}return i.result}async function Ce(t){const{factoryContract:e,predictAddressOverride:n,adminAddress:a,accountSalt:r,accountAddress:s}=t;if(n)return n(e);if(s)return s;if(!a)throw new Error("Account address is required to predict the smart wallet address.");const o=r&&j(r)?r:lt(r??"");return E({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[a,o]})}function bt(t){const{adminAddress:e,factoryContract:n,createAccountOverride:a,accountSalt:r}=t;if(a)return a(n);const s=r&&j(r)?r:lt(r??"");return W({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[e,s]})}function Ot(t){const{accountContract:e,transaction:n,executeOverride:a}=t;return a?a(e,n):W({contract:e,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"],gas:n.gas?n.gas+21000n:void 0})}function Ue(t){const{accountContract:e,transactions:n,executeBatchOverride:a}=t;return a?a(e,n):W({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map(r=>r.to||""),n.map(r=>r.value||0n),n.map(r=>r.data||"0x")]})}const Ie="0x35567e1a",Ve=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Se=[{type:"uint256",name:"nonce"}];async function Fe(t){return E({contract:t.contract,method:[Ie,Ve,Se],params:[t.sender,t.key]})}const Ne="0xa6193531",Re=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Me=[{type:"bytes32"}];async function $e(t){return E({contract:t.contract,method:[Ne,Re,Me],params:[t.userOp]})}const He="0x22cdde4c",Be=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],ke=[{type:"bytes32"}];async function je(t){return E({contract:t.contract,method:[He,Be,ke],params:[t.userOp]})}function ze(t){return t.factory?L([t.factory,t.factoryData||"0x"]):"0x"}function We(t){return L([_(O(t.verificationGasLimit),{size:16}),_(O(t.callGasLimit),{size:16})])}function qe(t){return L([_(O(t.maxPriorityFeePerGas),{size:16}),_(O(t.maxFeePerGas),{size:16})])}function Ze(t){return t.paymaster?L([t.paymaster,_(O(t.paymasterVerificationGasLimit||BigInt(0)),{size:16}),_(O(t.paymasterPostOpGasLimit||BigInt(0)),{size:16}),t.paymasterData||"0x"]):"0x"}const Ke=t=>({sender:t.sender,nonce:t.nonce,initCode:ze(t),callData:t.callData,accountGasLimits:We(t),preVerificationGas:t.preVerificationGas,gasFees:qe(t),paymasterAndData:Ze(t),signature:t.signature});async function V(t){var A;const{userOp:e,paymasterOverride:n,client:a,chain:r,entrypointAddress:s}=t;if(n)return n(e);const o={"Content-Type":"application/json"},i=s??P,c=z(r),u=await pt(a)(c,{method:"POST",headers:o,body:R({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[Z(e),i]})}),p=await u.json();if(!u.ok){const h=p.error||u.statusText,m=p.code||"UNKNOWN";throw new Error(`Paymaster error: ${h}
Status: ${u.status}
Code: ${m}`)}if(p.result)return typeof p.result=="string"?{paymasterAndData:p.result}:{paymasterAndData:p.result.paymasterAndData,verificationGasLimit:p.result.verificationGasLimit?w(p.result.verificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?w(p.result.preVerificationGas):void 0,callGasLimit:p.result.callGasLimit?w(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterData:p.result.paymasterData,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?w(p.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?w(p.result.paymasterPostOpGasLimit):void 0};const f=((A=p.error)==null?void 0:A.message)||p.error||u.statusText||"unknown error";throw new Error(`Paymaster error from ${c}: ${f}`)}const K=new Set,Y=t=>`${t.chain.id}:${t.address}`,Tt=t=>{K.add(Y(t))},Dt=t=>{K.delete(Y(t))},J=t=>K.has(Y(t));async function Ye(t){const e=t.timeoutMs||12e4,n=t.intervalMs||1e3,a=Date.now()+e;for(;Date.now()<a;){const r=await xe(t);if(r)return r;await new Promise(s=>setTimeout(s,n))}throw new Error("Timeout waiting for userOp to be mined")}async function Je(t){var y;const{transaction:e,accountContract:n,factoryContract:a,adminAddress:r,overrides:s,sponsorGas:o,waitForDeployment:i=!0}=t,c=e.chain,d=e.client,u={client:d,chain:c,bundlerUrl:s==null?void 0:s.bundlerUrl,entrypointAddress:s==null?void 0:s.entrypointAddress},p=mt(((y=t.overrides)==null?void 0:y.entrypointAddress)||P),[f,A,h,m,G]=await Promise.all([Bt(n),q(e),M(e.gas),Qe({executeTx:e,bundlerOptions:u,chain:c,client:d}),an({accountContract:n,chain:c,client:d,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:g,maxPriorityFeePerGas:l}=m;return p==="v0.7"?Xe({bundlerOptions:u,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:f,nonce:G,callData:A,callGasLimit:h,maxFeePerGas:g,maxPriorityFeePerGas:l,waitForDeployment:i}):tn({bundlerOptions:u,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:f,nonce:G,callData:A,callGasLimit:h,maxFeePerGas:g,maxPriorityFeePerGas:l,waitForDeployment:i})}async function Qe(t){const{executeTx:e,bundlerOptions:n,chain:a,client:r}=t;let{maxFeePerGas:s,maxPriorityFeePerGas:o}=e;const i=(n==null?void 0:n.bundlerUrl)??z(a);if(kt(i)){const c=await Pe({options:n});s=c.maxFeePerGas,o=c.maxPriorityFeePerGas}else{const[c,d]=await Promise.all([M(s),M(o)]);if(c&&d)s=c,o=d;else{const u=await jt(r,a);o=d??u.maxPriorityFeePerGas??0n,s=c??u.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:o}}async function Xe(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,callGasLimit:u,maxFeePerGas:p,maxPriorityFeePerGas:f,waitForDeployment:A}=t,{chain:h,client:m}=e;let G,g;n||J(r)?(g="0x",A&&await Pt(r)):(G=a.address,g=await q(bt({factoryContract:a,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount})),Tt(r));const l={sender:r.address,nonce:c,callData:d,maxFeePerGas:p,maxPriorityFeePerGas:f,callGasLimit:u??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:G,factoryData:g,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:yt};if(o){const y=await V({userOp:l,chain:h,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});if(y.paymaster&&y.paymasterData&&(l.paymaster=y.paymaster,l.paymasterData=y.paymasterData),y.callGasLimit&&y.verificationGasLimit&&y.preVerificationGas&&y.paymasterPostOpGasLimit&&y.paymasterVerificationGasLimit)l.callGasLimit=y.callGasLimit,l.verificationGasLimit=y.verificationGasLimit,l.preVerificationGas=y.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit;else{const T=await I({userOp:l,options:e});l.callGasLimit=T.callGasLimit,l.verificationGasLimit=T.verificationGasLimit,l.preVerificationGas=T.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit||0n;const D=await V({userOp:l,chain:h,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});D.paymaster&&D.paymasterData&&(l.paymaster=D.paymaster,l.paymasterData=D.paymasterData)}}else{const y=await I({userOp:l,options:e});l.callGasLimit=y.callGasLimit,l.verificationGasLimit=y.verificationGasLimit,l.preVerificationGas=y.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit||0n}return{...l,signature:"0x"}}async function tn(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,callGasLimit:u,maxFeePerGas:p,maxPriorityFeePerGas:f,waitForDeployment:A}=t,{chain:h,client:m}=e;let G;n||J(r)?(G="0x",A&&await Pt(r)):(G=await nn({factoryContract:a,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount}),Tt(r));const g={sender:r.address,nonce:c,initCode:G,callData:d,maxFeePerGas:p,maxPriorityFeePerGas:f,callGasLimit:u??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:yt};if(o){const l=await V({userOp:g,chain:h,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),y="paymasterAndData"in l?l.paymasterAndData:"0x";if(y&&y!=="0x"&&(g.paymasterAndData=y),l.callGasLimit&&l.verificationGasLimit&&l.preVerificationGas)g.callGasLimit=l.callGasLimit,g.verificationGasLimit=l.verificationGasLimit,g.preVerificationGas=l.preVerificationGas;else{const T=await I({userOp:g,options:e});if(g.callGasLimit=T.callGasLimit,g.verificationGasLimit=T.verificationGasLimit,g.preVerificationGas=T.preVerificationGas,y&&y!=="0x"){const D=await V({userOp:g,chain:h,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),F="paymasterAndData"in D?D.paymasterAndData:"0x";F&&F!=="0x"&&(g.paymasterAndData=F)}}}else{const l=await I({userOp:g,options:e});g.callGasLimit=l.callGasLimit,g.verificationGasLimit=l.verificationGasLimit,g.preVerificationGas=l.preVerificationGas}return{...g,signature:"0x"}}async function en(t){const{userOp:e,chain:n,entrypointAddress:a,adminAccount:r}=t,s=mt(a||P);let o;if(s==="v0.7"){const i=Ke(e);o=await je({contract:x({address:a||zt,chain:n,client:t.client}),userOp:i})}else o=await $e({contract:x({address:a||P,chain:n,client:t.client}),userOp:e});if(r.signMessage){const i=await r.signMessage({message:{raw:Wt(o)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function nn(t){const{factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r}=t,s=bt({factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:r});return L([e.address,await q(s)])}async function an(t){const{accountContract:e,chain:n,client:a,entrypointAddress:r,getNonceOverride:s}=t;return s?s(e):Fe({contract:x({address:r||P,chain:n,client:a}),key:Te(),sender:e.address})}async function Pt(t){const e=Date.now();for(;J(t);){if(Date.now()-e>6e4)throw Dt(t),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(n=>setTimeout(n,500))}}function sn(t){return t.id==="smart"}const xt=new WeakMap,H=new WeakMap;async function rn(t,e,n){var h,m,G,g,l;const{personalAccount:a,client:r,chain:s}=e;if(!a)throw new Error("Personal wallet does not have an account");const o=n,i=s??o.chain;if(o.factoryAddress&&!((h=o.overrides)!=null&&h.entrypointAddress)){const y=await pn(o.factoryAddress,r,i);y&&(o.overrides={...o.overrides,entrypointAddress:y})}const c=o.factoryAddress??qt((m=o.overrides)==null?void 0:m.entrypointAddress),d="gasless"in o?o.gasless:o.sponsorGas;if(await Zt(i))return[un({creationOptions:n,connectionOptions:e,chain:i,sponsorGas:d}),i];const u=x({client:r,address:c,chain:i}),p=await Ce({factoryContract:u,adminAddress:a.address,predictAddressOverride:(G=o.overrides)==null?void 0:G.predictAddress,accountSalt:(g=o.overrides)==null?void 0:g.accountSalt,accountAddress:(l=o.overrides)==null?void 0:l.accountAddress}).then(y=>y).catch(y=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${i.id}: ${(y==null?void 0:y.message)||"unknown error"}`,{cause:y})}),f=x({client:r,address:p,chain:i}),A=await cn({...o,chain:i,sponsorGas:d,personalAccount:a,accountContract:f,factoryContract:u,client:r});return xt.set(a,t),H.set(t,a),[A,i]}async function on(t){const e=H.get(t);e&&(xt.delete(e),H.delete(t))}async function cn(t){const{accountContract:e}=t,n={address:Kt(e.address),async sendTransaction(a){var i,c,d,u;const r=(i=t.overrides)==null?void 0:i.erc20Paymaster;let s;if(r){await dn({accountContract:e,erc20Paymaster:r,options:t});const p=async()=>({paymasterAndData:ee([r.address,r==null?void 0:r.token]),paymaster:r.address,paymasterData:"0x"});s=((c=t.overrides)==null?void 0:c.paymaster)||p}else s=(d=t.overrides)==null?void 0:d.paymaster;const o=Ot({accountContract:e,transaction:a,executeOverride:(u=t.overrides)==null?void 0:u.execute});return B({executeTx:o,options:{...t,overrides:{...t.overrides,paymaster:s}}})},async sendBatchTransaction(a){var s;const r=Ue({accountContract:e,transactions:a,executeBatchOverride:(s=t.overrides)==null?void 0:s.executeBatch});return B({executeTx:r,options:t})},async signMessage({message:a}){const[{isContractDeployed:r},{readContract:s},{encodeAbiParameters:o},{hashMessage:i},{checkContractWalletSignature:c}]=await Promise.all([v(()=>import("./index-BUbiDIUQ.js").then(h=>h.df),__vite__mapDeps([0,1])),v(()=>import("./index-BUbiDIUQ.js").then(h=>h.dd),__vite__mapDeps([0,1])),v(()=>import("./index-BUbiDIUQ.js").then(h=>h.dc),__vite__mapDeps([0,1])),v(()=>import("./hashMessage-CXkFUHbu.js"),__vite__mapDeps([2,0,1])),v(()=>import("./checkContractWalletSignature-BWwcMy3q.js"),__vite__mapDeps([3,4,0,1]))]);await r(e)||(await at({options:t,account:n,accountContract:e}),await st({accountContract:e}));const u=i(a);let p=!1;try{await s({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),p=!0}catch{}let f;if(p){const h=o([{type:"bytes32"}],[u]);f=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:h}})}else f=await t.personalAccount.signMessage({message:a});if(await c({contract:e,message:a,signature:f}))return f;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(a){var m,G,g;const r=ft(a),[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:i},{checkContractWalletSignedTypedData:c}]=await Promise.all([v(()=>import("./index-BUbiDIUQ.js").then(l=>l.df),__vite__mapDeps([0,1])),v(()=>import("./index-BUbiDIUQ.js").then(l=>l.dd),__vite__mapDeps([0,1])),v(()=>import("./index-BUbiDIUQ.js").then(l=>l.dc),__vite__mapDeps([0,1])),v(()=>import("./checkContractWalletSignedTypedData-Cbby885V.js"),__vite__mapDeps([5,4,0,1,6,7,8,9]))]);if(((G=(m=r.domain)==null?void 0:m.verifyingContract)==null?void 0:G.toLowerCase())===((g=e.address)==null?void 0:g.toLowerCase()))return t.personalAccount.signTypedData(r);await s(e)||(await at({options:t,account:n,accountContract:e}),await st({accountContract:e}));const p=pe(r);let f=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),f=!0}catch{}let A;if(f){const l=i([{type:"bytes32"}],[p]);A=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:l}})}else A=await t.personalAccount.signTypedData(r);if(await c({contract:e,data:r,signature:A}))return A;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(a){var r,s;return(s=(r=t.personalAccount).onTransactionRequested)==null?void 0:s.call(r,a)}};return n}async function dn(t){var u;const{accountContract:e,erc20Paymaster:n,options:a}=t,r=n.token,s=x({address:r,chain:e.chain,client:e.client});if(await we({contract:s,owner:e.address,spender:n.address})>0n)return;const i=Yt({contract:s,spender:n.address,amountWei:ne-1n}),c=await Jt({transaction:i,from:e.address}),d=Ot({accountContract:e,transaction:c,executeOverride:(u=a.overrides)==null?void 0:u.execute});await B({executeTx:d,options:{...a,overrides:{...a.overrides,erc20Paymaster:void 0}}})}function un(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,r={address:n.personalAccount.address,async sendTransaction(s){var u,p,f,A;const o={data:s.data,to:s.to??void 0,value:s.value??0n,chain:Qt(s.chainId),client:n.client,eip712:s.eip712};let i=await Xt({account:r,transaction:o});if(t.sponsorGas&&!i.paymaster){const h=await Le({options:{client:n.client,chain:a,bundlerUrl:(u=e.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(p=e.overrides)==null?void 0:p.entrypointAddress},transaction:i});i={...i,...h}}const c=await te({account:r,chainId:a.id,eip712Transaction:i});return{transactionHash:(await Ee({options:{client:n.client,chain:a,bundlerUrl:(f=e.overrides)==null?void 0:f.bundlerUrl,entrypointAddress:(A=e.overrides)==null?void 0:A.entrypointAddress},transaction:i,signedTransaction:c})).transactionHash,client:n.client,chain:a}},async signMessage({message:s}){return n.personalAccount.signMessage({message:s})},async signTypedData(s){const o=ft(s);return n.personalAccount.signTypedData(o)},async onTransactionRequested(s){var o,i;return(i=(o=n.personalAccount).onTransactionRequested)==null?void 0:i.call(o,s)}};return r}async function at(t){const{options:e,account:n,accountContract:a}=t,[{sendTransaction:r},{prepareTransaction:s}]=await Promise.all([v(()=>import("./index-BUbiDIUQ.js").then(c=>c.de),__vite__mapDeps([0,1])),v(()=>import("./index-BUbiDIUQ.js").then(c=>c.db),__vite__mapDeps([0,1]))]),o=s({client:e.client,chain:e.chain,to:a.address,value:0n,gas:50000n});return await r({transaction:o,account:n})}async function B(t){var c,d,u;const{executeTx:e,options:n}=t,a=await Je({transaction:e,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),r=await en({client:n.client,chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:(c=n.overrides)==null?void 0:c.entrypointAddress,userOp:a}),s={chain:n.chain,client:n.client,bundlerUrl:(d=n.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(u=n.overrides)==null?void 0:u.entrypointAddress},o=await De({options:s,userOp:r}),i=await Ye({...s,userOpHash:o});return Dt(n.accountContract),{client:n.client,chain:n.chain,transactionHash:i.transactionHash}}async function st(t){const{accountContract:e}=t,n=Date.now(),a=6e4,{isContractDeployed:r}=await v(async()=>{const{isContractDeployed:o}=await import("./index-BUbiDIUQ.js").then(i=>i.df);return{isContractDeployed:o}},__vite__mapDeps([0,1]));let s=await r(e);for(;!s;){if(Date.now()-n>a)throw new Error("Timeout: Smart account deployment not confirmed after 1 minute");await new Promise(o=>setTimeout(o,500)),s=await r(e)}}async function pn(t,e,n){const a=x({address:t,client:e,chain:n});try{return await E({contract:a,method:"function entrypoint() public view returns (address)"})}catch{return}}const hn=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:rn,disconnectSmartWallet:on,isSmartWallet:sn},Symbol.toStringTag,{value:"Module"}));export{pe as h,hn as i};
